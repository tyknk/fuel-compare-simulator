# 燃費比較シミュレーター 設計書

## プロジェクト概要

トヨタディーラーの商談で使用する、HEV車（ハイブリッド）とガソリン車の燃料コスト比較Webアプリ。
商談中にタブレットまたはPCのブラウザで開き、スライダーでパラメータを変更しながら顧客に結果を見せる。
「あなたの走行距離なら○年で元が取れますよ」と説明するための視覚的ツール。

## 成果物

`index.html` 単一ファイル。サーバー不要でダブルクリックで開ける。

## 技術仕様

- 単一HTMLファイル（HTML + CSS + JavaScript を1ファイルに）
- グラフ描画: Chart.js v4（CDN: https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js）
- CSS変数でカラーテーマ管理
- レスポンシブ対応（タブレット横向きを最優先、PC・スマホでも使用可能）
- 言語: 日本語

---

## 入力パラメータ

5つのパラメータ。すべて**スライダー（range input）と数値入力欄（number input）の双方向連動**。
スライダーを動かすと数値欄が更新され、数値欄を変更するとスライダーも追従する。

| # | パラメータ名 | 変数名 | デフォルト | 最小 | 最大 | 刻み | 単位 |
|---|------------|--------|-----------|------|------|------|------|
| 1 | ガソリン単価 | gasPrice | 170 | 100 | 250 | 1 | 円/L |
| 2 | 年間走行距離 | annualDistance | 10000 | 3000 | 30000 | 1000 | km |
| 3 | HEV車燃費 | hevMpg | 25.0 | 5.0 | 50.0 | 0.1 | km/L |
| 4 | ガソリン車燃費 | gasMpg | 15.0 | 5.0 | 50.0 | 0.1 | km/L |
| 5 | 車両価格差（HEVが高い分） | priceDiff | 350000 | 0 | 2000000 | 10000 | 円 |

※車種プリセット等は不要。商談のたびに手入力で設定する前提。

---

## 計算ロジック

### 年次計算（経過年数 n = 1〜13）

```javascript
for (let n = 1; n <= 13; n++) {
  cumDistance[n]  = annualDistance * n;                          // 累計走行距離
  hevCumCost[n]  = cumDistance[n] / hevMpg * gasPrice;          // HEV累計燃料代
  gasCumCost[n]  = cumDistance[n] / gasMpg * gasPrice;          // GAS累計燃料代
  fuelDiff[n]    = gasCumCost[n] - hevCumCost[n];              // 燃料代差額（累計）
  priceDiffRem[n] = priceDiff - fuelDiff[n];                   // 車両代金差額残
}
```

### KPI算出

```javascript
hevAnnualCost  = annualDistance / hevMpg * gasPrice;   // 年間燃料代（HEV）
gasAnnualCost  = annualDistance / gasMpg * gasPrice;   // 年間燃料代（GAS）
annualSaving   = gasAnnualCost - hevAnnualCost;        // 年間節約額
breakEvenYear  = priceDiffRem が初めて 0以下になる n の値。該当なしなら「13年以上」
```

### 検算用データ

以下の入力条件で計算結果が合うことを確認すること:

入力: ガソリン単価=140, 年間走行距離=10000, HEV燃費=15.0, GAS燃費=9.0, 車両価格差=350000

| 年数 | 走行距離 | HEV燃料代 | GAS燃料代 | 差額 | 車両代金差額残 |
|------|---------|-----------|-----------|------|-------------|
| 1 | 10,000 | 93,333 | 155,556 | 62,222 | 287,778 |
| 5 | 50,000 | 466,667 | 777,778 | 311,111 | 38,889 |
| 6 | 60,000 | 560,000 | 933,333 | 373,333 | -23,333 |
| 13 | 130,000 | 1,213,333 | 2,022,222 | 808,889 | -458,889 |

この条件では6年目で損益分岐（車両代金差額残がマイナスに転じる）。

---

## 画面構成

上から順に以下のセクションを配置。

### 1. ヘッダー
- タイトル: 「燃費比較シミュレーター」
- シンプルな1行ヘッダー

### 2. パラメータ入力エリア
- ガソリン単価・年間走行距離: 横2列でスライダー＋数値表示
- HEV燃費・GAS燃費・車両価格差: 横3列でスライダー＋数値表示
- 各パラメータにはラベルと単位を明記
- スライダーを動かすと全セクション（KPI・グラフ・テーブル）がリアルタイム更新

### 3. KPIカード（4つ横並び）

| カード | 表示内容 | 色 | サイズ |
|-------|---------|---|-------|
| 年間HEV燃料代 | 金額（円） | ブルー系 | 大きめ |
| 年間GAS燃料代 | 金額（円） | オレンジ系 | 大きめ |
| 年間節約額 | 金額（円） | 強調色 | 大きめ |
| 損益分岐年数 | ○年目 or 13年以上 | 最も目立つ色・最大フォント | **最も大きく** |

損益分岐年数が商談の最重要ポイントなので、4つのKPIの中で最も大きく目立たせること。

### 4. グラフ（Chart.js 折れ線グラフ）
- X軸: 経過年数（1〜13年）
- データセット1: HEV累計燃料代（青系ライン、ラベル「HEV」）
- データセット2: GAS累計燃料代（オレンジ系ライン、ラベル「ガソリン車」）
- ツールチップ: 金額をカンマ区切り＋「円」表示
- Y軸: 金額（円）、カンマ区切り
- Chart.jsインスタンスはグローバルに1つ保持し、パラメータ変更時は chart.update() で更新する（destroy/再生成はしないこと）

### 5. 年次比較テーブル
- スプレッドシートの表を忠実に再現

| 列ヘッダー | 内容 |
|-----------|------|
| 経過年数 | 1〜13 |
| 累計走行距離 | km表示、カンマ区切り |
| HEV燃料代 | 円表示、カンマ区切り |
| GAS燃料代 | 円表示、カンマ区切り |
| 差額 | 円表示、カンマ区切り |
| 車両代金差額残 | 円表示、カンマ区切り |

- 損益分岐年（車両代金差額残が初めて0以下になる行）: 背景をハイライト（黄色系）
- 車両代金差額残がマイナスの行: 薄い緑系背景（元が取れた状態を示す）
- 全ての金額は整数に丸めて表示（Math.round）

### 6. フッター
- テキスト: 「※入力された燃費に基づく試算です。実際の燃費は走行条件により異なります。」
- 小さめフォント、グレー文字

### 7. 印刷ボタン
- 画面右上または上部に「印刷」ボタン配置
- window.print() を呼ぶ
- @media print で: 印刷ボタン非表示、スライダー非表示（数値のみ表示）、背景色を印刷向けに調整

---

## デザイン仕様

### カラー（CSS変数で定義）
```css
:root {
  --hev-color: #2563EB;        /* HEV関連: ブルー */
  --hev-light: #DBEAFE;        /* HEV薄い背景 */
  --gas-color: #EA580C;        /* GAS関連: オレンジ */
  --gas-light: #FFF7ED;        /* GAS薄い背景 */
  --saving-color: #16A34A;     /* 節約・プラス: グリーン */
  --saving-light: #DCFCE7;     /* 節約薄い背景 */
  --breakeven-color: #DC2626;  /* 損益分岐: レッド（注目色） */
  --bg-main: #F9FAFB;          /* メイン背景 */
  --bg-card: #FFFFFF;          /* カード背景 */
  --text-primary: #111827;     /* メイン文字色 */
  --text-secondary: #6B7280;   /* サブ文字色 */
  --border-color: #E5E7EB;     /* ボーダー */
}
```

### フォント
- 数字は等幅系（tabular-nums）で桁揃え
- KPI数値: 2rem以上、font-weight: bold
- 損益分岐年数: 2.5rem以上で最大

### レイアウト
- max-width: 1200px で中央配置
- パラメータエリア、KPI、グラフ、テーブルの間に適切な余白
- タブレット横向き（1024px以上）でKPIは4列横並び
- スマホ（768px未満）ではKPIは2×2グリッド

---

## コード構造の指針

```
index.html
├── <style> ... </style>          // CSS（全スタイル）
├── <div id="app">                // メインコンテナ
│   ├── ヘッダー
│   ├── パラメータ入力エリア       // input[type=range] + input[type=number]
│   ├── KPIカード                 // 4つのdiv
│   ├── グラフ                    // <canvas id="chart">
│   ├── テーブル                  // <table>
│   ├── フッター
│   └── 印刷ボタン
├── <script src="Chart.js CDN">
└── <script>
    ├── パラメータ取得・同期関数
    ├── calculate() 関数          // 全計算を実行
    ├── updateKPI() 関数          // KPIカード更新
    ├── updateChart() 関数        // Chart.js更新（chart.update()を使用）
    ├── updateTable() 関数        // テーブル再描画
    ├── formatNumber() 関数       // 3桁カンマ区切り
    ├── イベントリスナー登録       // input イベントで双方向同期
    └── 初期化処理                // ページ読込時に初回計算実行
</script>
```

---

## 作業の進め方

1. この設計書（SPEC.md）を読んで内容を把握する
2. index.html を作成する
3. 検算用データ（上記の表）で計算結果を検証する
4. 完成したら報告する
